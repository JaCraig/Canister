<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title> Canister | Canister API Reference </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content=" Canister | Canister API Reference ">
      
      
      <link rel="icon" href="favicon.ico">
      <link rel="stylesheet" href="public/docfx.min.css">
      <link rel="stylesheet" href="public/main.css">
      <meta name="docfx:navrel" content="toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="">
      
      
      <meta name="docfx:docurl" content="https://github.com/JaCraig/Canister/blob/master/docfx_project/index.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="index.html">
            <img id="logo" class="svg" src="images/icon.png" alt="Canister">
            Canister
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="-canister"><img src="https://jacraig.github.io/Canister/images/icon.png" style="height:25px" alt="Canister Icon"> Canister</h1>

<p><a href="https://github.com/JaCraig/Canister/actions/workflows/dotnet-publish.yml"><img src="https://github.com/JaCraig/Canister/actions/workflows/dotnet-publish.yml/badge.svg" alt=".NET Publish"></a> <a href="https://coveralls.io/github/JaCraig/Canister?branch=master"><img src="https://coveralls.io/repos/github/JaCraig/Canister/badge.svg?branch=master" alt="Coverage Status"></a> <a href="https://www.nuget.org/packages/Canister.IoC/"><img src="https://img.shields.io/nuget/v/Canister.IoC.svg" alt="NuGet"></a></p>
<p>Canister is one of the easiest ways to get IoC configuration under control. No longer do you have to search for that one class that you forgot to register. Instead use Canister to handle discovery and registration for you using a simple interface.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#quick-start">Quick Start</a></li>
<li><a href="#basic-usage">Basic Usage</a></li>
<li><a href="#modules">Modules</a></li>
<li><a href="#attributes">Attributes</a></li>
<li><a href="#canister-extension-methods">Canister Extension Methods</a></li>
<li><a href="#working-with-other-ioc-containers">Working With Other IoC Containers</a></li>
<li><a href="#using-canister-in-your-library">Using Canister in Your Library</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#build-process">Build Process</a></li>
</ul>
<h2 id="quick-start">Quick Start</h2>
<pre><code class="lang-csharp">using Microsoft.Extensions.DependencyInjection;

var services = new ServiceCollection();
services.AddCanisterModules();
var provider = services.BuildServiceProvider();
</code></pre>
<p>For a more detailed example, you can check out the <a href="https://jacraig.github.io/Canister/articles/intro.html">Canister Example</a> which demonstrates how to use Canister in a couple simple scenarios.</p>
<h2 id="basic-usage">Basic Usage</h2>
<p>The system has a fairly simple interface and only a couple of functions that need explaining. The first is setup:</p>
<pre><code class="lang-csharp">    public void ConfigureServices(IServiceCollection services)
    {
        ...
        services.AddCanisterModules();
    }
</code></pre>
<p>AddCanisterModules will automatically scan assemblies for modules and load them accordingly. Or if you're doing a desktop app:</p>
<pre><code class="lang-csharp">    var Services = new ServiceCollection().AddCanisterModules();
</code></pre>
<p>Note that if you like, you can control which assemblies are searched:</p>
<pre><code class="lang-csharp">    public void ConfigureServices(IServiceCollection services)
    {
        ...
        services.AddCanisterModules(configure =&gt; configure.AddAssembly(typeof(Startup).Assembly));
    }
</code></pre>
<blockquote>
<p><strong>Note:</strong> For security reasons, it's recommended to explicitly specify which assemblies to scan. By default, Canister will search all assemblies found in the entry assembly's top-level directory.</p>
</blockquote>
<p>It is also possible to add logging to the system while configuring it. This is useful for debugging purposes or to get insights into the registration process. You can do this by passing an <code>ILogger</code> instance to the <code>UseLogger</code> method along with a default log level:</p>
<pre><code class="lang-csharp">    public void ConfigureServices(IServiceCollection services, ILogger logger)
    {
        ...
        services.AddCanisterModules().UseLogger(logger, LogLevel.Information);
    }
</code></pre>
<h2 id="modules">Modules</h2>
<p>Canister uses the concept of modules to wire things up, but is not a requirement. This allows you to place registration code in libraries that your system is using instead of worrying about it in every application. Simply add your library and Canister will automatically wire it up for you. In order to do this, under Canister.Interfaces there is the IModule interface. This interface, when implemented, has two items in it. The first is a property called Order. This determines the order that the modules are loaded in. The second is a function called Load:</p>
<pre><code class="lang-csharp">    public class TestModule : IModule
    {
        public int Order =&gt; 1;

        public void Load(IServiceCollection bootstrapper)
        {
		    bootstrapper.AddAllTransient&lt;IMyInterface&gt;();
			bootstrapper.AddTransient&lt;MyType&gt;();
        }
    }
</code></pre>
<p>The module above is loaded automatically by the system and will have the Load function called at initialization time. At this point you should be able to resolve and register classes using the bootstrapper parameter. The service collection also has a couple of extra extension methods: AddAllTransient, AddAllScoped, AddAllSingleton:</p>
<pre><code class="lang-csharp">    bootstrapper.AddAllTransient&lt;IMyInterface&gt;();
</code></pre>
<p>The AddAllxxxx functions will find everything that implements a class or interface in the Assemblies that you tell it to look in and will register them with the service collection.</p>
<h2 id="attributes">Attributes</h2>
<p>Canister also allows for attributes to be used to control registration. There are two attributes that the system uses:</p>
<ul>
<li>RegisterAttribute - This attribute is used to control how a class is registered. It will register the class as all interfaces that it implements as well as the class itself. The attribute takes the life time of the registration as a parameter. If no parameter is given, the registration will be transient. It also can take a service key as well.</li>
</ul>
<pre><code class="lang-csharp">    [Register(LifeTime.Singleton)]
    public class MyType : IMyInterface
    {
    }
</code></pre>
<ul>
<li>RegisterAllAttribute - This attribute is used to control how an interface is registered. It will register all classes that implement the interface similar to the AddAllxxxx functions. The attribute takes the life time of the registration as a parameter. If no parameter is given, the registration will be transient.</li>
</ul>
<pre><code class="lang-csharp">    [RegisterAll(LifeTime.Singleton)]
    public interface IMyInterface
    {
    }
</code></pre>
<h3 id="canister-extension-methods">Canister Extension Methods</h3>
<p>Canister provides a set of extension methods to streamline your IoC (Inversion of Control) container registration code. These methods offer convenient ways to conditionally register services based on certain criteria, enhancing the flexibility of your application's dependency injection setup. Note that these can be used even if you are not using the Canister modules.</p>
<h4 id="1-addtransientif">1. <code>AddTransientIf()</code></h4>
<p>The <code>AddTransientIf</code> method registers a service as transient only if a specified condition is met. This is useful when you want to dynamically determine whether a service should be transient or not.</p>
<pre><code class="lang-csharp">services.AddTransientIf&lt;IMyService, MyService&gt;(services =&gt; condition);
</code></pre>
<h4 id="2-addscopedif">2. <code>AddScopedIf()</code></h4>
<p>Similar to <code>AddTransientIf</code>, <code>AddScopedIf</code> registers a service as scoped based on a given condition.</p>
<pre><code class="lang-csharp">services.AddScopedIf&lt;IMyScopedService, MyScopedService&gt;(services =&gt; condition);
</code></pre>
<h4 id="3-addsingletonif">3. <code>AddSingletonIf()</code></h4>
<p>The <code>AddSingletonIf</code> method registers a service as a singleton if the specified condition holds true.</p>
<pre><code class="lang-csharp">services.AddSingletonIf&lt;IMySingletonService, MySingletonService&gt;(services =&gt; condition);
</code></pre>
<h4 id="4-addkeyedtransientif-addkeyedscopedif-addkeyedsingletonif">4. <code>AddKeyedTransientIf()</code>, <code>AddKeyedScopedIf()</code>, <code>AddKeyedSingletonIf()</code></h4>
<p>These methods follow the same pattern as their non-keyed counterparts but additionally allow you to register services with a specified key.</p>
<pre><code class="lang-csharp">services.AddKeyedTransientIf&lt;IService&gt;(key, implementationType, (services, key) =&gt; condition);
</code></pre>
<h4 id="5-exists">5. <code>Exists()</code></h4>
<p>The <code>Exists</code> method checks whether a service with a specific type and, optionally, a key, has already been registered. This can be helpful in avoiding duplicate registrations or finding issues with your environment before starting the application.</p>
<pre><code class="lang-csharp">if (!services.Exists&lt;IMyService&gt;())
{
    services.AddTransient&lt;IMyService, MyService&gt;();
}
</code></pre>
<h4 id="6-addalltransient-addallscoped-addallsingleton">6. <code>AddAllTransient()</code>, <code>AddAllScoped()</code>, <code>AddAllSingleton()</code></h4>
<p>These methods allow you to register all implementations of a given interface or class as transient, scoped, or singleton services, respectively. They are particularly useful for bulk registrations.</p>
<pre><code class="lang-csharp">services.AddAllTransient&lt;IMyService&gt;();
services.AddAllScoped&lt;IMyScopedService&gt;();
services.AddAllSingleton&lt;IMySingletonService&gt;();
</code></pre>
<h3 id="usage-example">Usage Example</h3>
<p>Here's an example of how you might use these methods:</p>
<pre><code class="lang-csharp">
IHostEnvironment? environment;

// Conditionally register a transient service if in development environment.
services.AddTransientIf&lt;IMyService, MyDebugService&gt;(_ =&gt; environment.IsDevelopment());

// However if you're in production, add a different implementation.
services.AddTransientIf&lt;IMyService, MyProductionService&gt;(_ =&gt; environment.IsProduction());

// Check if a keyed service is missing and log a warning if so.
if (!services.Exists&lt;IService&gt;(key))
{
    logger.LogWarning(&quot;Service {Service} is missing&quot;, key);
}

</code></pre>
<p>These methods empower you to create more dynamic and adaptive dependency injection configurations tailored to your application's requirements.</p>
<h2 id="working-with-other-ioc-containers">Working With Other IoC Containers</h2>
<p>While the library assumes you are using the built in ServiceCollection, it is possible to work with IoC containers. All that is required is that it implements the IServiceCollection interface.</p>
<h2 id="using-canister-in-your-library">Using Canister in Your library</h2>
<p>If you wish to use Canister in your library, it is recommended that you build an extension method off of the ICanisterConfiguration interface that will allow you to register your needed assemblies for the user to make the experience a bit simpler when they want to control configuration themselves.</p>
<h2 id="installation">Installation</h2>
<p>The library is available via Nuget with the package name &quot;Canister.IoC&quot;. To install it run the following command in the Package Manager Console:</p>
<pre><code class="lang-powershell">dotnet add package Canister.IoC
</code></pre>
<h2 id="build-process">Build Process</h2>
<p>In order to build the library you may require the following:</p>
<ol>
<li>Visual Studio 2022</li>
</ol>
<p>Other than that, just clone the project and you should be able to load the solution and build without too much effort.</p>
<h2 id="license">License</h2>
<p>This project is licensed under the Apache License 2.0 - see the <a href="../LICENSE">LICENSE</a> file for details.</p>
<h2 id="contributing">Contributing</h2>
<p>If you would like to contribute to the project, please fork the repository and submit a pull request. Contributions are welcome, and we appreciate any help in improving the library. Please refer to the <a href="../CONTRIBUTING.md">Contributing Guide</a> for more details on how to contribute.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/JaCraig/Canister/blob/master/docfx_project/index.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <strong><a href='https://github.com/JaCraig/Canister'>Open in Github</a></strong>
        </div>
      </div>
    </footer>
  </body>
</html>
